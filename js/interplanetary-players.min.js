let sw,sh,cellWidth,cellHeight;var btW,btH;let params,worldI_dist,cardColor,xData,yData,zData,xDataNorm,yDataNorm,zDataNorm,easyX,easyY,bodyRenderer,font1,t1,t2,t3,t4,t5,t6,t7,t8,t11,t12,t13,t14,t15,t16,t17,t18,notDOM,device,canvas,regenIcon,initialPlayIcon,playIcon,pauseIcon,centerIcon,loadP=!0,showText="Receiving Sound Waves \n Unmute device \n & \n Turn on IP engine";var regenValue;let knobSpacing,domAlpha,domColor2,bodySize,knobs=[],ksteps=255,ksensitivity=.9,klabels=["X","Y","Z"],sliders=[],ssteps=255,ssensitivity=.9,slabels=["Gain"],sliderSpacing=0;var game,deck,suit,loadDeck,exoData;let inputX,inputY,inputZ,inputGain,index,increasing,playStateI,wMinD=444,wMaxD=1544,prevTouchX=0,prevTouchY=0,isFirstPlay=!0,lastUpdateTime=Date.now(),lastOrbitUpdateTime=lastUpdateTime;var card={id:"",wavfile:"",mp3file:"",initTime:"",endTime:"",speed:"",minSpeed:"",maxSpeed:"",col1:"",col2:"",icon_set:"",engine:"",xTag:"",yTag:"",zTag:""};document.oncontextmenu=()=>!1;var easycam,state={distance:444,center:[0,0,0],rotation:[1,0,0,0]},panelX=30,panelY=45;function preload(){params=getURLParams(),game=loadJSON("data/"+params.g+".min.json"),font1=loadFont("fonts/Orbitron-VariableFont_wght.ttf"),exoData=loadJSON("data/exoplanetData.min.json"),regenValue=0}function setup(){canvas=createCanvas(window.innerWidth,window.innerHeight,WEBGL),setAttributes("antialias",!0),frameRate(30),bodyRenderer=new BodyRenderer(bodySize),initVariables(),xDataNorm=1,yDataNorm=0,index=0,increasing=!0,playStateI=0,setCurrentIndexToToday(),0==params.s&&(card=game.A[params.c]),1==params.s&&(card=game.B[params.c]),2==params.s&&(card=game.C[params.c]),(easycam=createEasyCam()).setState(state,3e3),easycam.setDistanceMin(wMinD),easycam.setDistanceMax(wMaxD),easycam.state_reset=state,easycam.setPanScale(0),easycam.setPanScale(.02),easycam.removeMouseListeners(),cardColor=color(card.col1),textFont(font1),textSize(8),initSliders(),initKnobs(),createDom()}function draw(){background(0,0,0),noStroke(),loadP&&loadingGUI(showText),easycam.rotateY(playStateI*easyY),easycam.rotateX(playStateI*easyX),bodyRenderer.renderBody(),bodyRenderer.stars(),drawHUD(),0!=regenValue&&regenUpdates()}function drawHUD(){easycam.beginHUD(),noFill(),stroke(cardColor);strokeWeight(1.5),beginShape(),vertex(3.3,3.3),vertex(.86*sw,3.3),vertex(sw-3.3,.14*sh),vertex(sw-3.3,sh-3.3),vertex(.14*sw,sh-3.3),vertex(3.3,sh-3.3),vertex(3.3,3.3),endShape(),loadP?drawOverlay():draw3DGUI(),easycam.endHUD()}function draw3DGUI(){knobs.forEach((knob=>{drawKnob(knob)})),sliders.forEach((slider=>{drawSlider(slider)}))}function drawKnob(knob){let angleY=map(knob.valueY,0,ksteps-1,0,360,!0);stroke(regenValue>0?domColor2:cardColor),push(),strokeWeight(.5),translate(knob.x,knob.y),rotateZ(radians(angleY)),fill(0,50),sphere(.5*knob.size,7,7),rotateZ(radians(90)),strokeWeight(3),line(.5*knob.size,0,0,0),pop()}function drawSlider(slider){push(),stroke(cardColor),translate(slider.x,slider.y,slider.z),slider.isDragging&&cone(10,slider.sliderHeight,10),translate(0,slider.sliderValue,0),fill(0,50),rotateX(PI),rotateY(.005*slider.sliderValue),cone(slider.handleRadius,slider.handleHeight,7),pop()}function drawOverlay(){fill(0,0,0,1),noStroke(),rect(0,0,sw,sh)}function regenUpdates(){switch(regenValue){case 0:break;case 1:trans(1);break;case 2:trans(60);break;case 3:trans(1200);break;case 4:trans(6e3);break;case 5:orb(1);break;case 6:orb(60);break;case 7:orb(6e3)}}function trans(amp){let currentTime=Date.now(),elapsedTimeInMillis=currentTime-lastUpdateTime;lastUpdateTime=currentTime;let scaledIncrement=elapsedTimeInMillis/1728e5*amp;increasing?(index+=scaledIncrement,index>=.99&&(index=.99,increasing=!1)):(index-=scaledIncrement,index<=.01&&(index=.01,increasing=!0));let result=interpolateTransitData(exoData,index),targetX=255*index,targetY=255*result.normalizedB,targetZ=255*result.normalizedDuration;function interpolate(currentValue,targetValue){return Math.abs(targetValue-currentValue)>1?currentValue+.1*(targetValue-currentValue):targetValue}xData=interpolate(xData,targetX),yData=interpolate(yData,targetY),zData=interpolate(zData,targetZ),xInput(),yInput(),zInput(),setKnobValue(knobs[0],50,xData,50),setKnobValue(knobs[1],50,yData,50),setKnobValue(knobs[2],50,zData,50),t15.html(result.transitDate),t16.html(nfs(result.b,1,2)),t17.html(nfs(result.duration,1,2))}function orb(amp){let currentTime=Date.now(),elapsedTimeInMillis=currentTime-lastOrbitUpdateTime;lastOrbitUpdateTime=currentTime,index+=elapsedTimeInMillis/1728e5*amp,index%=1;const orbitData=generateOrbitData(exoData,index);let targetX=255*orbitData.d.orbitPosition,targetY=255*orbitData.c.orbitPosition,targetZ=255*orbitData.b.orbitPosition;function interpolate(currentValue,targetValue){return Math.abs(targetValue-currentValue)>1?currentValue+.1*(targetValue-currentValue):targetValue}xData=interpolate(xData,targetX),yData=interpolate(yData,targetY),zData=interpolate(zData,targetZ),xInput(),yInput(),zInput(),setKnobValue(knobs[0],50,xData,50),setKnobValue(knobs[1],50,yData,50),setKnobValue(knobs[2],50,zData,50),t15.html(nfs(orbitData.d.dayInOrbit,1,2)),t16.html(nfs(orbitData.b.dayInOrbit,1,2)),t17.html(nfs(orbitData.c.dayInOrbit,1,2))}function regenLogic(){switch(regenValue=(regenValue+1)%8){case 0:regenButton.html("&#9842;"),t11.html(""),t12.html(""),t13.html(""),t15.html(""),t16.html(""),t17.html(""),t21.html("A playground for improvisation and deep listening"),t22.html("0"),t0.html("Jam"),t22.style("color",domAlpha);break;case 1:regenButton.html("&#9843;"),t11.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pX1+":"),t12.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pY1+":"),t13.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pZ1+":"),t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.General),t22.html("1"),t0.html("Transit I"),t22.style("color",domColor2);break;case 2:regenButton.html("&#9844;"),t11.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pX1+":"),t12.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pY1+":"),t13.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pZ1+":"),t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.General),t22.html("2"),t0.html("Transit II"),t22.style("color",domColor2);break;case 3:regenButton.html("&#9845;"),t11.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pX1+":"),t12.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pY1+":"),t13.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pZ1+":"),t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.General),t22.html("3"),t0.html("Transit III"),t22.style("color",domColor2);break;case 4:regenButton.html("&#9846;"),t11.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pX1+":"),t12.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pY1+":"),t13.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pZ1+":"),t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.General),t22.html("4"),t0.html("Transit IIII"),t22.style("color",domColor2);break;case 5:regenButton.html("&#9847;"),t11.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pX2+":"),t12.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pY2+":"),t13.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pZ2+":"),t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_description),t22.html("5"),t0.html("Orbits V"),t22.style("color",domColor2);break;case 6:regenButton.html("&#9848;"),t11.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pX2+":"),t12.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pY2+":"),t13.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pZ2+":"),t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_description),t22.html("6"),t0.html("Orbits VI"),t22.style("color",domColor2);break;case 7:regenButton.html("&#9849;"),t11.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pX2+":"),t12.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pY2+":"),t13.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.pZ2+":"),t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_description),t22.html("7"),t0.html("Orbits VII"),t22.style("color",domColor2)}}async function playPause(){notDOM=!1,isFirstPlay&&createRNBO(),"suspended"===context.state?(isFirstPlay&&handleFirstPlay(),await context.resume().then((()=>{playButton.attribute("src",playIcon),showText="All engines are running \n press play to start"})).catch((err=>{console.log("Failed to resume AudioContext:",err)})),"suspended"===context.state&&setTimeout(tryResumeContext,100)):(isFirstPlay&&handleFirstPlay(),togglePlayState())}async function handleFirstPlay(){playButton.attribute("src",initialPlayIcon),isFirstPlay=!1,loadP=!0}function togglePlayState(){if(!device||!RNBO)return showText="All engines are running \n press play to start",void playButton.attribute("src",initialPlayIcon);if(0==playStateI&&"running"===context.state){loadP&&(guiData(),regenButton.show(),xButton.show(),yButton.show(),zButton.show(),setKnobValueY(knobs[0],127,500),setKnobValueY(knobs[1],127,500),setKnobValueY(knobs[2],127,500),loadP=!1);try{let messageEvent=new RNBO.MessageEvent(RNBO.TimeNow,"play",[1]);device.scheduleEvent(messageEvent),playStateI=1,playButton.attribute("src",pauseIcon)}catch(err){console.log("Failed to schedule play event:",err)}}else try{let messageEvent=new RNBO.MessageEvent(RNBO.TimeNow,"play",[0]);device.scheduleEvent(messageEvent),playButton.attribute("src",initialPlayIcon),context.suspend().catch((err=>{console.log("Failed to suspend AudioContext:",err)})),playStateI=0}catch(err){console.log("Failed to schedule stop event:",err)}}function xB(){switch(regenValue){case 0:notDOM=!1,setKnobValueY(knobs[0],127,500),t21.html("X Balance");break;case 1:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Transit_s1);break;case 2:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Transit_s2);break;case 3:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Transit_s3);break;case 4:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Transit_s4);break;case 5:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s5x);break;case 6:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s6x);break;case 7:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s7x)}}function yB(){switch(regenValue){case 0:notDOM=!1,setKnobValueY(knobs[1],127,500),t21.html("Y Balance");break;case 1:case 2:case 3:case 4:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.b);break;case 5:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s5y);break;case 6:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s6y);break;case 7:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s7y)}}function zB(){switch(regenValue){case 0:notDOM=!1,setKnobValueY(knobs[2],127,500),t21.html("Z Balance");break;case 1:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Duration_s1);break;case 2:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Duration_s2);break;case 3:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Duration_s3);break;case 4:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.Duration_s4);break;case 5:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s5z);break;case 6:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s6z);break;case 7:t21.html(exoData["Kepler-47"].Maar_World.parameter_descriptions.orbital_s7z)}}function errorLoadingAudio(_error){let p=createP(_error);p.style("font-size","16px"),p.position(10,0)}function createDom(){let domColor=color(card.col1);domAlpha=color(card.col1),domAlpha.setAlpha(190),domColor2=color(0,255,128),centerIcon="icons/"+nf(card.icon_set,2)+"_center.svg",xButton=createImg(centerIcon,"Play Button","&#11042"),xButton.style("width",btW+"px"),xButton.style("height",btH+"px"),xButton.style("background-color",domColor),xButton.style("color",domAlpha),xButton.style("border","none"),xButton.style("background","none"),xButton.style("-webkit-touch-callout","none"),xButton.mousePressed(xB),xButton.touchStarted(xB),xButton.mouseReleased(releaseDOM),xButton.touchEnded(releaseDOM),yButton=createImg(centerIcon,"Play Button","&#11042"),yButton.style("width",btW+"px"),yButton.style("height",btH+"px"),yButton.style("background-color",domColor),yButton.style("color",domAlpha),yButton.style("border","none"),yButton.style("background","none"),yButton.style("-webkit-touch-callout","none"),yButton.mousePressed(yB),yButton.touchStarted(yB),yButton.mouseReleased(releaseDOM),yButton.touchEnded(releaseDOM),zButton=createImg(centerIcon,"Play Button","&#11042"),zButton.style("width",btW+"px"),zButton.style("height",btH+"px"),zButton.style("background-color",domColor),zButton.style("color",domAlpha),zButton.style("border","none"),zButton.style("background","none"),zButton.style("-webkit-touch-callout","none"),zButton.mousePressed(zB),zButton.touchStarted(zB),zButton.mouseReleased(releaseDOM),zButton.touchEnded(releaseDOM),initialPlayIcon="icons/"+nf(card.icon_set,2)+"_on-off.svg",playIcon="icons/"+nf(card.icon_set,2)+"_play.svg",playButton=createImg(initialPlayIcon,"Play Button","&#9655"),pauseIcon="icons/"+nf(card.icon_set,2)+"_pause.svg",playButton.style("width",btW+"px"),playButton.style("height",btH+"px"),playButton.style("background-color",domColor),playButton.style("color",domAlpha),playButton.style("border","none"),playButton.style("background","none"),playButton.style("-webkit-touch-callout","none"),playButton.mousePressed(playPause),playButton.touchStarted(playPause),playButton.mouseReleased(releaseDOM),playButton.touchEnded(releaseDOM),regenIcon="icons/"+nf(card.icon_set,2)+"_regen.svg",regenButton=createImg(regenIcon,"Regen Button","&#9842"),regenButton.style("width",btW+"px"),regenButton.style("height",btH+"px"),regenButton.style("border","none"),regenButton.style("background","none"),regenButton.style("-webkit-touch-callout","none"),regenButton.mousePressed(regenLogic),regenButton.touchStarted(regenLogic),regenButton.mouseReleased(releaseDOM),regenButton.touchEnded(releaseDOM),updateButtonPositions(),regenButton.hide(),xButton.hide(),yButton.hide(),zButton.hide()}function xInput(){inputX.value=xData;let xDataM=map(xData,0,ksteps-1,float(card.xTag[1]),float(card.xTag[2]));t6.html(nfs(xDataM,1,2)),easyY=-.0077*xDataM}function yInput(){inputY.value=yData;let yDataM=map(yData,0,ksteps-1,float(card.yTag[1]),float(card.yTag[2]));t7.html(nfs(yDataM,1,2)),easyX=-77e-5*yDataM}function zInput(){worldI_dist=zData<=(ksteps-1)/2?map(zData,0,(ksteps-1)/2,wMaxD,wMinD,!0):map(zData,(ksteps-1)/2,ksteps-1,wMinD,wMaxD,!0),easycam.setDistance(worldI_dist,1),inputZ.value=zData,t5.html(nfs(worldI_dist,1,2)),zDataV=map(zData,0,255,float(card.zTag[1]),float(card.zTag[2])),t8.html(nfs(zDataV,1,2))}function gainInput(){inputGain.value=inputGain}function guiData(){t1=createP("Distance:"),t2=createP(card.xTag[0]+":"),t3=createP(card.yTag[0]+":"),t4=createP(card.zTag[0]+":"),t5=createP(),t5.html(worldI_dist),t6=createP();let formattedNumber=nfs(parseFloat("0.00"),1,2);t6.html(formattedNumber),t7=createP("0"),t8=createP("0"),t11=createP(""),t12=createP(""),t13=createP(""),t15=createP(),t15.html(""),t16=createP(),t16.html(""),t17=createP(""),t21=createP(""),t22=createP("0"),t0=createP("Jam"),guiDataStyle(cellWidth,cellHeight)}function guiDataStyle(cellWidth,cellHeight){let yoffset=cellHeight,textColor=card.col1,black=color(0);sw>sh&&(yoffset=.5*cellHeight);let guiTextSize=.027*min(windowWidth,windowHeight);[t1,t2,t3,t4,t11,t12,t13].forEach(((elem,index)=>{let x=1*cellWidth,y=index*cellHeight*.5+guiTextSize+yoffset;elem.position(x,y),elem.style("color",textColor),elem.style("font-size",guiTextSize+"px")})),[t5,t6,t7,t8,t15,t16,t17].forEach(((elem,index)=>{let x=3.5*cellWidth*1,y=index*cellHeight*.5+guiTextSize+yoffset;elem.position(x,y),elem.style("color",textColor),elem.style("font-size",guiTextSize+"px")})),t0.style("color",domColor2),t0.style("width",6*btW+"px"),t0.attribute("align","center"),t0.position(.5*sw-3*btW,guiTextSize),t0.style("font-size",guiTextSize+10+"px"),t21.style("background-color",black),t21.style("color",domColor2),t21.style("width",6*btW+"px"),t21.attribute("align","center"),t21.position(.5*sw-3*btW,.2*sh),t21.style("font-size",guiTextSize+"px"),t22.style("background-color",black),t22.style("color",textColor),t22.style("width",btW+"px"),t22.attribute("align","center"),t22.position(sw-(cellWidth+cellHeight),sh-cellHeight),t22.style("font-size",guiTextSize+"px")}function loadingGUI(showText){textAlign(CENTER),fill(cardColor),translate(0,-30,150*bodySize),text(showText,0,0),translate(0,30,-150*bodySize)}function windowResized(){initVariables(),resizeCanvas(sw,sh),guiDataStyle(cellWidth,cellHeight),easycam.setViewport([0,0,sw,sh]),translateKnobs(),translateSliders()}function pressDOM(){notDOM=!1}function releaseDOM(){notDOM=!0,loadP||t21.html("")}function mousePressed(){return knobs.forEach((knob=>{knob.isDragging=dist(mouseX,mouseY,knob.x,knob.y)<knob.size/2})),sliders.forEach((sliders=>{dist(mouseX,mouseY,sliders.x,sliders.y+sliders.sliderValue)<sliders.handleRadius&&(sliders.isDragging=!0,pressDOM())})),!1}function mouseDragged(){knobs.forEach(((knob,index)=>{dist(mouseX,mouseY,knob.x,knob.y)<.75*knob.size&&(knob.isDragging=!0,updateKnobValue(knob,mouseX,mouseY),pressDOM())})),sliders.forEach((sliders=>{sliders.isDragging&&(sliders.sliderValue=constrain(mouseY-sliders.y,-sliders.sliderHeight/2,sliders.sliderHeight/2),inputGain.value=map(sliders.sliderValue,sliders.sliderHeight/2,-220,0,1))}))}function mouseWheel(event){pressDOM(),knobs.forEach((knob=>{if(dist(mouseX,mouseY,knob.x,knob.y)<knob.size/2){let deltaZ=event.delta*ksensitivity;knob.valueZ=constrain(knob.valueZ-deltaZ,0,ksteps-1),worldI_dist=map(knob.valueZ,0,ksteps-1,wMinD,wMaxD)}}))}function mouseReleased(){knobs.forEach((knob=>knob.isDragging=!1)),sliders.forEach((sliders=>sliders.isDragging=!1))}function touchStarted(){return prevTouchX=touches[0].x,prevTouchY=touches[0].y,knobs.forEach((knob=>{knob.isDragging=dist(touches[0].x,touches[0].y,knob.x,knob.y)<knob.size/2})),sliders.forEach((sliders=>{dist(touches[0].x,touches[0].y,sliders.x,sliders.y+sliders.sliderValue)<sliders.handleRadius&&(sliders.isDragging=!0,pressDOM())})),!1}function touchMoved(){return knobs.forEach((knob=>{knob.isDragging&&updateKnobValue(knob,touches[0].x,touches[0].y)})),sliders.forEach((sliders=>{sliders.isDragging&&(sliders.sliderValue=constrain(touches[0].y-sliders.y,-sliders.sliderHeight/2,sliders.sliderHeight/2),inputGain.value=map(sliders.sliderValue,sliders.sliderHeight/2,-sliders.sliderHeight/2,0,1))})),prevTouchX=touches[0].x,prevTouchY=touches[0].y,!1}function touchEnded(){return knobs.forEach((knob=>knob.isDragging=!1)),sliders.forEach((sliders=>sliders.isDragging=!1)),!1}function doubleClicked(){}function initVariables(){sw=window.innerWidth,sh=window.innerHeight;let cellSize=min(width,height)/10,cols=floor(width/cellSize),rows=floor(height/cellSize);xData=127,yData=127,zData=127,cellWidth=sw/cols,cellHeight=sh/rows,btW=cellHeight,btH=cellHeight,knobSpacing=1.1*(cellWidth+cellHeight),bodySize=.0067*(cellWidth+cellHeight),bodyRenderer.setBodySize(bodySize),notDOM=!0}function initSliders(){let startX=.9*window.innerWidth,startY=.5*window.innerHeight;for(let i=0;i<1;i++)sliders.push({x:startX+i*sliderSpacing,y:startY,z:0,sliderHeight:4*cellHeight,sliderValue:-127,sliderMin:0,sliderMax:127,isDragging:!1,handleHeight:btH,handleRadius:.5*btW})}function initKnobs(){let startX=.5*window.innerWidth-knobSpacing,startY=.75*window.innerHeight;for(let i=0;i<klabels.length;i++)knobs.push({x:startX+i*knobSpacing,y:startY,z:0,size:.77*(cellWidth+cellHeight),valueX:127,valueY:127,valueZ:127})}function updateKnobValue(knob,currentX,currentY){let deltaX,deltaY;touches.length>0?(deltaX=currentX-prevTouchX,deltaY=currentY-prevTouchY):(deltaX=currentX-pmouseX,deltaY=currentY-pmouseY),knob.valueX-=deltaX*ksensitivity,knob.valueY-=deltaY*ksensitivity,knob.valueX=constrain(knob.valueX,0,ksteps-1),knob.valueY=constrain(knob.valueY,0,ksteps-1),knob===knobs[0]?(xData=knob.valueY,xInput()):knob===knobs[1]?(yData=knob.valueY,yInput()):knob===knobs[2]&&(zData=knob.valueY,zInput())}function setKnobValueY(knob,newValueY,interpolationTimeInMillis){let totalFrames=interpolationTimeInMillis/1e3*frameRate(),changePerFrame=(newValueY-knob.valueY)/totalFrames;!function interpolateKnobValue(){Math.abs(knob.valueY-newValueY)>Math.abs(changePerFrame)?(knob.valueY+=changePerFrame,knob.valueY=constrain(knob.valueY,0,ksteps-1),updateKnobRelatedData(knob),setTimeout(interpolateKnobValue,1e3/frameRate)):(knob.valueY=newValueY,updateKnobRelatedData(knob))}()}function updateKnobRelatedData(knob){knob===knobs[0]?(xData=knob.valueY,xInput()):knob===knobs[1]?(yData=knob.valueY,yInput()):knob===knobs[2]&&(zData=knob.valueY,zInput())}function setKnobValue(knob,newXValue,newYValue,newZValue){knob.valueX=newXValue,knob.valueY=newYValue,knob.valueZ=newZValue,knob.valueX=constrain(knob.valueX,0,ksteps-1),knob.valueY=constrain(knob.valueY,0,ksteps-1),knob.valueZ=constrain(knob.valueZ,0,ksteps-1),knob===knobs[0]?(xData=knob.valueY,xInput()):knob===knobs[1]?(yData=knob.valueY,yInput()):knob===knobs[2]&&(zData=knob.valueY,zInput())}function updateButtonPositions(){if(!canvas||!canvas.elt)return void console.error("Canvas is not defined");let offsetY=cellHeight;knobs.forEach(((knob,index)=>{let screenX=knob.x-.5*cellWidth,screenY=offsetY+knob.y;0===index?xButton.position(screenX,screenY):1===index?yButton.position(screenX,screenY):2===index&&zButton.position(screenX,screenY)})),playButton.position(cellWidth,sh-2*cellHeight),regenButton.position(sw-(cellWidth+cellHeight),sh-2*cellHeight),playButton.style("width",btW+"px"),playButton.style("height",btH+"px"),regenButton.style("width",btW+"px"),regenButton.style("height",btH+"px")}function translateSliders(){let sstartX=.9*window.innerWidth,sstartY=.5*window.innerHeight;for(let i=0;i<1;i++)sliders[i].x=sstartX+i,sliders[i].y=sstartY,sliders[i].z=0,sliders[i].sliderHeight=4*cellHeight,sliders[i].sliderValue=-124,sliders[i].sliderMin=0,sliders[i].sliderMax=127,sliders[i].isDragging=!1,sliders[i].handleHeight=btH,sliders[i].handleRadius=.5*btW}function translateKnobs(){let kstartX=.5*window.innerWidth-knobSpacing,kstartY=.75*window.innerHeight,knobSize=.77*(cellWidth+cellHeight);for(let i=0;i<knobs.length;i++)knobs[i].x=kstartX+i*knobSpacing,knobs[i].y=kstartY,knobs[i].size=knobSize;xButton.style("width",btW+"px"),xButton.style("height",btH+"px"),yButton.style("width",btW+"px"),yButton.style("height",btH+"px"),zButton.style("width",btW+"px"),zButton.style("height",btH+"px"),updateButtonPositions()}async function createRNBO(){try{const patchExportURL="export/"+card.engine;let WAContext=window.AudioContext||window.webkitAudioContext;context=new WAContext;let rawPatcher=await fetch(patchExportURL),patcher=await rawPatcher.json();device=await RNBO.createDevice({context:context,patcher:patcher}),device.node.connect(context.destination),loadAudioBuffer(context),inputX=device.parametersById.get("inputX"),inputY=device.parametersById.get("inputY"),inputZ=device.parametersById.get("inputZ"),inputGain=device.parametersById.get("inputGain");const centerValue=(ksteps-1)/2;inputX.value=map(centerValue,0,ksteps-1,parseFloat(card.xTag[1]),parseFloat(card.xTag[2])),inputY.value=map(centerValue,0,ksteps-1,parseFloat(card.yTag[1]),parseFloat(card.yTag[2])),inputZ.value=map(centerValue,0,ksteps-1,parseFloat(card.zTag[1]),parseFloat(card.zTag[2])),inputGain.value=map(0,-220,220,0,1),knobs[0].valueY=centerValue,knobs[1].valueY=centerValue,knobs[2].valueY=centerValue,sliders[0].sliderValue=0,showText="Main engine \n start sequence initiated \n press again"}catch(error){console.log(error),errorLoadingAudio(error)}}async function loadAudioBuffer(_context){let audioBuf;context=_context;try{let audioURL;if(navigator.connection){audioURL=navigator.connection.downlink>1?card.mp3file:card.wavfile}else audioURL=card.mp3file;try{const fileResponse=await fetch(audioURL,{cache:"reload"});if(!fileResponse.ok)throw new Error("Network response was not OK");const arrayBuf=await fileResponse.arrayBuffer();if(!(arrayBuf instanceof ArrayBuffer))throw new Error("Fetched data is not a valid ArrayBuffer");try{audioBuf=await context.decodeAudioData(arrayBuf),await device.setDataBuffer("world1",audioBuf)}catch(decodeError){throw console.error("Error decoding audio data or setting data buffer:",decodeError),decodeError}}catch(fetchError){throw console.error("There has been a problem with your fetch operation:",fetchError),fetchError}}catch(error){console.log("Error type:",typeof error),console.log("Error details:",error),errorLoadingAudio(error)}}function interpolateTransitData(transitData,index){const transits=transitData["Kepler-47"].Maar_World.transits,numTransits=transits.length,pos=index*(numTransits-1),lowerIndex=Math.floor(pos),upperIndex=Math.ceil(pos),t=pos-lowerIndex;if(lowerIndex===upperIndex||upperIndex>=numTransits)return{...transits[lowerIndex],exactTransitDate:julianToDate(transits[lowerIndex].BJD)};const lowerTransit=transits[lowerIndex],upperTransit=transits[upperIndex],interpolate=(start,end,t)=>(1-t)*start+t*end,exactTransitDate=julianToDate(interpolate(lowerTransit.BJD,upperTransit.BJD,t)+2455e3);return{normalizedB:interpolate(lowerTransit.Normalized_b,upperTransit.Normalized_b,t),normalizedDuration:interpolate(lowerTransit.Normalized_Duration_hrs,upperTransit.Normalized_Duration_hrs,t),b:interpolate(lowerTransit.b,upperTransit.b,t),duration:interpolate(lowerTransit.Duration_hrs,upperTransit.Duration_hrs,t),transitDate:exactTransitDate,normalizedBJD:interpolate(lowerTransit.Normalized_BJD,upperTransit.Normalized_BJD,t)}}function generateOrbitData(json,index){function getOrbitData(orbitalPeriod,index){const normalizedIndex=index*orbitalPeriod,phase=normalizedIndex%orbitalPeriod/orbitalPeriod*2*Math.PI;return{dayInOrbit:normalizedIndex%orbitalPeriod,orbitPosition:(Math.sin(phase)+1)/2}}const periodB=json["Kepler-47"].Planets["Kepler-47 b"].orbital_period_days,periodC=json["Kepler-47"].Planets["Kepler-47 c"].orbital_period_days,periodD=json["Kepler-47"].Planets["Kepler-47 d"].orbital_period_days;return{b:getOrbitData(periodB,index),c:getOrbitData(periodC,index*periodC/periodB),d:getOrbitData(periodD,index*periodD/periodB)}}function gregorianToJulian(year,month,day){month<=2&&(year-=1,month+=12);let A=Math.floor(year/100),B=2-A+Math.floor(A/4);return Math.floor(365.25*(year+4716))+Math.floor(30.6001*(month+1))+day+B-1524.5}function julianToDate(julian){const jd=julian+.5,Z=Math.floor(jd),F=jd-Z;let A=Z;if(Z>=2299161){const alpha=Math.floor((Z-1867216.25)/36524.25);A+=1+alpha-Math.floor(alpha/4)}const B=A+1524,C=Math.floor((B-122.1)/365.25),D=Math.floor(365.25*C),E=Math.floor((B-D)/30.6001),day=B-D-Math.floor(30.6001*E)+F,month=E<14?E-1:E-13,year=month>2?C-4716:C-4715;return`${Math.floor(day)}-${month}-${year}`}function setCurrentIndexToToday(){const transits=exoData["Kepler-47"].Maar_World.transits,numTransits=transits.length,today=new Date,todayBJD=gregorianToJulian(today.getFullYear(),today.getMonth()+1,today.getDate())-2455e3;let pastTransitIndex=0,futureTransitIndex=numTransits-1;for(let i=0;i<numTransits;i++){if(!(transits[i].BJD<todayBJD)){futureTransitIndex=i;break}pastTransitIndex=i}const pastBJD=transits[pastTransitIndex].BJD,futureBJD=transits[futureTransitIndex].BJD;return index=(pastTransitIndex+(todayBJD-pastBJD)/(futureBJD-pastBJD))/(numTransits-1),index=Math.max(0,Math.min(index,numTransits-1)),index}document.oncontextmenu=()=>!1,document.body.addEventListener("touchstart",(function(e){e.target==document.body&&e.preventDefault()}),{passive:!1});